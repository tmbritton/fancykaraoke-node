---
import HostLayout from '../../layouts/HostLayout.astro';
import VideoPlayer from '../../components/VideoPlayer.astro';
import { getPartyBySlug } from '../../controllers/partyController';
import { getCurrentSong } from '../../controllers/queueController';
import SongQueue from '../../components/SongQueue.astro';
import { sanitizeString } from '../../helpers/string';

const { slug } = Astro.params;
const party = await getPartyBySlug(slug as string);
const sanitizedSlug = sanitizeString(slug as string);
const currentSong = await getCurrentSong(sanitizedSlug)
---

<HostLayout
  title={`${party?.name} | Host Party | Fancy Karaoke`}
  partyId={slug as string}
>
  <section class="videoSection" slot="video">
    <VideoPlayer
      songId={currentSong?.id as number}
      partySlug={slug as string}
      queueItemId={currentSong.queue_id}
      autoplay={0}
    />
  </section>
  <section class="queueSection" slot="side">
    <SongQueue slug={sanitizedSlug}/>
  </section>
</HostLayout>

<style>
  .videoSection {
    position: relative;
    overflow: hidden;
    width: 100%;
  }
  .videoSection::after {
    display: block;
    content: "";
    padding-top: 56.25%;
  }

</style>